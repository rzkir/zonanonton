---
import HeroCorousel from "@/components/anime/hero/HeroCorousel.astro";

import Ongoing from "@/components/anime/ongoing/Ongoing.astro";

import Completed from "@/components/anime/completed/Completed.astro";

import Schedule from "@/components/anime/schedule/Schedule.astro";

import Recent from "@/components/manga/recent/Recent.astro";

import ManhwaPopular from "@/components/manga/manhwa-popular/ManhwaPopular.astro";

import ManhuaPopular from "@/components/manga/manhua-popular/ManhuaPopular.astro";

import MangaPopular from "@/components/manga/manga-popular/MangaPopuplar.astro";
import FIlmSlider from "@/components/film/slider/FIlmSlider.astro";
import BoxOffice from "@/components/film/boxoffice/BoxOffice.astro";
import SerialTv from "@/components/film/serialtv/SerialTv.astro";
import FilmPopular from "@/components/film/popular/FilmPopular.astro";
import LastMovie from "@/components/film/lastmovie/LastMovie.astro";
import FilmAnime from "@/components/film/anime/FilmAnime.astro";

export interface Props {
  initialData: HomeData | null;
  scheduleData?: ScheduleData | null;
  initialMangaHomeData?: MangaHomeData | null;
  initialFilmData?: FilmData | null;
}

const { initialData, scheduleData: scheduleDataProp = null, initialMangaHomeData = undefined, initialFilmData = null } = Astro.props;

const scheduleData = scheduleDataProp ?? { days: [] };

const {  completedList, hero } = initialData ?? { ongoingList: [], completedList: [], hero: { title: '', description: '', image: '', type: 'anime', year: '', rating: '', animeId: '' }, heroes: [] };
const heroesList: HeroData[] = initialData?.heroes?.length ? initialData?.heroes : [hero];
const heroAnimeIds = new Set(heroesList.map((h: HeroData) => h.animeId).filter(Boolean));
const ongoingListWithoutHeroes = initialData?.ongoingList?.filter((item: OngoingAnime) => !heroAnimeIds.has(item.animeId)) ?? [];
---

{
  !initialData?.ongoingList?.length && !initialData?.completedList?.length ? (
    <section class="max-w-[1440px] mx-auto px-6 min-h-screen pt-28 pb-10">
      <!-- Hero skeleton -->
      <div class="relative h-[70vh] min-h-[400px] max-h-[560px] rounded-2xl overflow-hidden bg-white/5 border border-white/5">
        <div class="skeleton-shimmer absolute inset-0 bg-linear-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-shimmer" />
        <div class="absolute inset-0 flex flex-col justify-end p-8 sm:p-10 hero-gradient">
          <div class="h-8 w-3/4 max-w-md rounded-lg bg-white/10 mb-3" />
          <div class="h-4 w-full max-w-xl rounded bg-white/5 mb-2" />
          <div class="h-4 w-2/3 max-w-md rounded bg-white/5" />
        </div>
      </div>

      <main class="-mt-32 relative z-10 space-y-10">
        <!-- Ongoing row skeleton -->
        <div>
          <div class="h-6 w-40 rounded bg-white/10 mb-4 skeleton-pulse" />
          <div class="flex gap-4 overflow-hidden">
            {[1, 2, 3, 4, 5].map((i) => (
              <div class="shrink-0 w-[180px] sm:w-[200px]">
                <div class="aspect-2/3 rounded-xl bg-white/5 overflow-hidden relative">
                  <div class="skeleton-shimmer absolute inset-0 bg-linear-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-shimmer" style={`animation-delay: ${i * 0.1}s`} />
                </div>
                <div class="mt-2 h-4 w-full rounded bg-white/5 skeleton-pulse" />
                <div class="mt-1 h-3 w-2/3 rounded bg-white/5 skeleton-pulse" />
              </div>
            ))}
          </div>
        </div>

        <!-- Completed grid skeleton -->
        <div>
          <div class="h-6 w-44 rounded bg-white/10 mb-4 skeleton-pulse" />
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((i) => (
              <div>
                <div class="aspect-2/3 rounded-xl bg-white/5 overflow-hidden relative">
                  <div class="skeleton-shimmer absolute inset-0 bg-linear-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-shimmer" style={`animation-delay: ${i * 0.08}s`} />
                </div>
                <div class="mt-2 h-4 w-full rounded bg-white/5 skeleton-pulse" />
                <div class="mt-1 h-3 w-3/4 rounded bg-white/5 skeleton-pulse" />
              </div>
            ))}
          </div>
        </div>

        <!-- Schedule skeleton -->
        <div>
          <div class="h-6 w-36 rounded bg-white/10 mb-4 skeleton-pulse" />
          <div class="flex gap-2 flex-wrap">
            {["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu", "Minggu"].map((_, i) => (
              <div class="h-10 w-20 rounded-lg bg-white/5 skeleton-pulse" />
            ))}
          </div>
          <div class="mt-4 flex gap-4 overflow-hidden">
            {[1, 2, 3, 4].map((i) => (
              <div class="shrink-0 w-[140px]">
                <div class="aspect-2/3 rounded-lg bg-white/5 overflow-hidden relative">
                  <div class="skeleton-shimmer absolute inset-0 bg-linear-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-shimmer" style={`animation-delay: ${i * 0.12}s`} />
                </div>
                <div class="mt-2 h-3 w-full rounded bg-white/5 skeleton-pulse" />
              </div>
            ))}
          </div>
        </div>

        <!-- Manga CTA skeleton -->
        <div class="rounded-xl overflow-hidden border border-white/5 min-h-[140px] bg-linear-to-r from-white/5 via-white/[0.07] to-white/5 flex items-center justify-between px-6 py-6">
          <div class="space-y-2">
            <div class="h-3 w-16 rounded bg-white/10 skeleton-pulse" />
            <div class="h-6 w-56 rounded bg-white/10 skeleton-pulse" />
            <div class="h-4 w-48 rounded bg-white/5 skeleton-pulse" />
          </div>
          <div class="h-5 w-32 rounded bg-white/10 skeleton-pulse" />
        </div>
      </main>
      <style>
        @keyframes shimmer {
          100% { transform: translateX(100%); }
        }
        .animate-shimmer {
          animation: shimmer 2s ease-in-out infinite;
        }
        .skeleton-pulse {
          animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
          50% { opacity: 0.6; }
        }
      </style>
    </section>
  ) : (
    <>
      <HeroCorousel heroesList={heroesList} />

      <!-- Content Sections -->
      <main class="max-w-[1440px] mx-auto px-6 -mt-32 relative z-10 space-y-10">
        <!-- Ongoing Anime (Continue Watching style) -->
        <Ongoing ongoingList={ongoingListWithoutHeroes} />

        <!-- Completed Anime (Completed Anime grid) -->
        <Completed completedList={completedList} />

        <!-- Schedule (Anime schedule) -->
        <Schedule scheduleData={scheduleData} />

        <!-- Banner Promotion Section Manga -->
        <a
          href="/manga"
          class="block w-full rounded-xl overflow-hidden border border-white/5 transition-all duration-300 group"
        >
          <div class="relative min-h-[140px] sm:min-h-[160px] flex items-center justify-between gap-6 px-6 sm:px-10 py-6 bg-linear-to-r from-cyan-950/60 via-blue-950/50 to-purple-950/40">
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_80%_80%_at_30%_50%,rgba(34,211,238,0.15),transparent)]" />
            <div class="relative flex-1 min-w-0">
              <span class="text-cyan-400 text-xs font-bold uppercase tracking-wider">Manga</span>
              <h2 class="text-xl sm:text-2xl font-bold text-white mt-1 group-hover:text-cyan-200 transition-colors">
                Jelajahi Manga, Manhwa & Manhua
              </h2>
              <p class="text-gray-400 text-sm mt-1">
                Baca ribuan judul terbaru dan populer dalam satu tempat.
              </p>
            </div>
            <span class="relative shrink-0 inline-flex items-center gap-2 text-cyan-400 font-medium group-hover:gap-3 transition-all">
              Ke Section Manga
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </span>
          </div>
        </a>

        <!-- Recent Manga (Recent Manga list) -->
        <Recent komikuList={initialMangaHomeData?.recent?.komikuList ?? []} />

        <!-- Popular Manga (Popular Manga list) -->
        <MangaPopular mangaList={initialMangaHomeData?.komiku_popular?.mangaList ?? []} />
        
        <!-- Popular Manga (Popular Manga list) -->
        <MangaPopular mangaList={initialMangaHomeData?.manga_popular?.mangaList ?? []} />

        <!-- Popular Manhwa (Popular Manhwa list) -->
        <ManhwaPopular mangaList={initialMangaHomeData?.manhwa_popular?.mangaList ?? []} />

        <!-- Popular Manhua (Popular Manhua list) -->
        <ManhuaPopular mangaList={initialMangaHomeData?.manhua_popular?.mangaList ?? []} />

        <!-- Film sections -->
        {initialFilmData && (
          <>
            <FIlmSlider sliderList={initialFilmData.slider ?? []} />
            <BoxOffice boxofficeList={initialFilmData.boxoffice ?? []} />
            <SerialTv serialtvList={initialFilmData.serialtv ?? []} />
            <FilmPopular popularList={initialFilmData.popular ?? []} />
            <LastMovie lastmovieList={initialFilmData.lastmovie ?? []} />
            <FilmAnime animeList={initialFilmData.anime ?? []} />
          </>
        )}
      </main>
    </>
  )
}
