---
import HeroCorousel from "@/components/anime/hero/HeroCorousel.astro";
import Ongoing from "@/components/anime/ongoing/Ongoing.astro";
import Completed from "@/components/anime/completed/Completed.astro";
import Schedule from "@/components/anime/schedule/Schedule.astro";
import Recent from "@/components/manga/recent/Recent.astro";
import ManhwaPopular from "@/components/manga/manhwa-popular/ManhwaPopular.astro";
import ManhuaPopular from "@/components/manga/manhua-popular/ManhuaPopular.astro";
import MangaPopular from "@/components/manga/manga-popular/MangaPopuplar.astro";

export interface Props {
  initialData: HomeData | null;
  scheduleData?: import("@/lib/FetchAnime").ScheduleData | null;
  initialMangaHomeData?: MangaHomeData | null;
}

const { initialData, scheduleData: scheduleDataProp = null, initialMangaHomeData = undefined } = Astro.props;

const scheduleData = scheduleDataProp ?? { days: [] };

const {  completedList, hero } = initialData ?? { ongoingList: [], completedList: [], hero: { title: '', description: '', image: '', type: 'anime', year: '', rating: '', animeId: '' }, heroes: [] };
const heroesList: HeroData[] = initialData?.heroes?.length ? initialData?.heroes : [hero];
const heroAnimeIds = new Set(heroesList.map((h: HeroData) => h.animeId).filter(Boolean));
const ongoingListWithoutHeroes = initialData?.ongoingList?.filter((item: OngoingAnime) => !heroAnimeIds.has(item.animeId)) ?? [];
---

{
  !initialData?.ongoingList?.length && !initialData?.completedList?.length ? (
    <div class="max-w-[1440px] mx-auto px-6 py-16 text-center">
      <p class="text-gray-400 mb-2">Gagal memuat data.</p>
      <p class="text-gray-500 text-sm mb-4">
        Pastikan <code class="bg-white/10 px-1 rounded">PUBLIC_API_BASE</code>{" "}
        dan <code class="bg-white/10 px-1 rounded">PUBLIC_API_SECRET</code> ada
        di file .env (dev) atau Environment variables (Cloudflare).
      </p>
    </div>
  ) : (
    <>
      <HeroCorousel heroesList={heroesList} />

      <!-- Content Sections -->
      <main class="max-w-[1440px] mx-auto px-6 -mt-32 relative z-10 space-y-10">
        <!-- Ongoing Anime (Continue Watching style) -->
        <Ongoing ongoingList={ongoingListWithoutHeroes} />

        <!-- Completed Anime (Completed Anime grid) -->
        <Completed completedList={completedList} />

        <!-- Schedule (Anime schedule) -->
        <Schedule scheduleData={scheduleData} />

        <!-- Banner Promotion Section Manga -->
        <a
          href="/manga"
          class="block w-full rounded-xl overflow-hidden border border-white/5 transition-all duration-300 group"
        >
          <div class="relative min-h-[140px] sm:min-h-[160px] flex items-center justify-between gap-6 px-6 sm:px-10 py-6 bg-linear-to-r from-cyan-950/60 via-blue-950/50 to-purple-950/40">
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_80%_80%_at_30%_50%,rgba(34,211,238,0.15),transparent)]" />
            <div class="relative flex-1 min-w-0">
              <span class="text-cyan-400 text-xs font-bold uppercase tracking-wider">Manga</span>
              <h2 class="text-xl sm:text-2xl font-bold text-white mt-1 group-hover:text-cyan-200 transition-colors">
                Jelajahi Manga, Manhwa & Manhua
              </h2>
              <p class="text-gray-400 text-sm mt-1">
                Baca ribuan judul terbaru dan populer dalam satu tempat.
              </p>
            </div>
            <span class="relative shrink-0 inline-flex items-center gap-2 text-cyan-400 font-medium group-hover:gap-3 transition-all">
              Ke Section Manga
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </span>
          </div>
        </a>

        <!-- Recent Manga (Recent Manga list) -->
        <Recent komikuList={initialMangaHomeData?.recent?.komikuList ?? []} />

        <!-- Popular Manga (Popular Manga list) -->
        <MangaPopular mangaList={initialMangaHomeData?.komiku_popular?.mangaList ?? []} />
        
        <!-- Popular Manga (Popular Manga list) -->
        <MangaPopular mangaList={initialMangaHomeData?.manga_popular?.mangaList ?? []} />

        <!-- Popular Manhwa (Popular Manhwa list) -->
        <ManhwaPopular mangaList={initialMangaHomeData?.manhwa_popular?.mangaList ?? []} />

        <!-- Popular Manhua (Popular Manhua list) -->
        <ManhuaPopular mangaList={initialMangaHomeData?.manhua_popular?.mangaList ?? []} />
      </main>
    </>
  )
}
