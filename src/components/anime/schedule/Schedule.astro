---
export interface Props {
  scheduleData?: ScheduleData | null;
}

const { scheduleData: scheduleDataProp = null } = Astro.props;

const scheduleData = scheduleDataProp ?? { days: [] };

// Get today's day name in Indonesian
const dayNames = [
  "Minggu",
  "Senin",
  "Selasa",
  "Rabu",
  "Kamis",
  "Jumat",
  "Sabtu",
];
const today = new Date().getDay();
const todayName = dayNames[today];

// Find today's schedule day ID
let todayDayId: string | null = null;
if (scheduleData.days?.length > 0) {
  const todayDay = scheduleData.days.find((day) =>
    day.day.toLowerCase().includes(todayName.toLowerCase()),
  );
  if (todayDay) {
    todayDayId = todayDay.day.toLowerCase().replace(/\s+/g, "-");
  }
}
---

<!-- Release Schedule (dari API) -->
<section id="schedule">
  <div
    class="flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-6"
  >
    <h2 class="text-2xl font-bold flex items-center gap-3 text-white">
      <span class="w-1.5 h-8 bg-cyan-500 rounded-full"></span>
      Release Schedule
    </h2>
    {
      scheduleData.days?.length > 0 && (
        <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2 lg:pb-0">
          {scheduleData.days.map((dayItem, i) => {
            const dayId = dayItem.day.toLowerCase().replace(/\s+/g, "-");
            const isToday = todayDayId === dayId;
            return (
              <button
                type="button"
                data-filter={dayId}
                class:list={[
                  "schedule-filter-btn flex-none px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap",
                  isToday
                    ? "bg-cyan-500 text-white shadow-lg shadow-cyan-500/25"
                    : "bg-white/5 text-gray-400 hover:text-white hover:bg-white/10",
                ]}
              >
                {dayItem.day}
              </button>
            );
          })}
        </div>
      )
    }
  </div>

  {
    scheduleData.days?.length > 0 ? (
      <div class="flex flex-col gap-6">
        {scheduleData.days.map((dayItem) => {
          const dayId = dayItem.day.toLowerCase().replace(/\s+/g, "-");
          const isToday = todayDayId === dayId;
          return (
            <div
              id={`day-${dayId}`}
              data-day={dayId}
              class:list={[
                "schedule-day-section scroll-mt-24",
                !isToday && "hidden",
              ]}
            >
              <h3 class="text-lg font-bold text-cyan-400 mb-4 flex items-center gap-2">
                <span class="w-1 h-6 bg-cyan-500 rounded-full" />
                {dayItem.day}
              </h3>
              <div class="flex flex-col gap-3">
                {dayItem.animeList.map((anime) => (
                  <div class="flex items-center gap-4 md:gap-8 p-4 md:p-6 bg-white/5 border border-white/5 rounded-2xl hover:bg-white/10 transition-all group">
                    <div class="flex-1 min-w-0">
                      <a
                        href={`/anime/${anime.animeId}`}
                        class="text-lg md:text-xl font-bold text-white truncate block group-hover:text-cyan-400 transition-colors"
                      >
                        {anime.title}
                      </a>
                      <span class="inline-block mt-1 px-3 py-0.5 rounded-full bg-cyan-500/10 text-cyan-400 text-[10px] font-black border border-cyan-500/20 tracking-wider uppercase">
                        Anime
                      </span>
                    </div>
                    <a
                      href={`/anime/${anime.animeId}`}
                      class="flex-none px-4 py-2 rounded-xl bg-white/5 hover:bg-cyan-500 hover:text-white text-gray-400 text-sm font-medium transition-all shrink-0"
                    >
                      Lihat
                    </a>
                    <button
                      type="button"
                      class="flex-none w-12 h-12 rounded-xl bg-white/5 hover:bg-cyan-500 hover:text-white text-gray-400 transition-all flex items-center justify-center shrink-0"
                      aria-label="Remind"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
                      </svg>
                    </button>
                  </div>
                ))}
              </div>
            </div>
          );
        })}
      </div>
    ) : (
      <p class="text-gray-500 text-sm py-8 text-center">
        Jadwal belum tersedia. Pastikan API schedule mengembalikan data.
      </p>
    )
  }
</section>

<style>
  .schedule-day-section.hidden {
    display: none;
  }
</style>

<script is:inline>
  (function () {
    const filterButtons = document.querySelectorAll(".schedule-filter-btn");
    const daySections = document.querySelectorAll(".schedule-day-section");

    if (filterButtons.length === 0 || daySections.length === 0) return;

    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const filterValue = btn.getAttribute("data-filter");

        // Update button styles
        filterButtons.forEach((b) => {
          if (b === btn) {
            b.classList.remove(
              "bg-white/5",
              "text-gray-400",
              "hover:bg-white/10",
            );
            b.classList.add(
              "bg-cyan-500",
              "text-white",
              "shadow-lg",
              "shadow-cyan-500/25",
            );
          } else {
            b.classList.remove(
              "bg-cyan-500",
              "text-white",
              "shadow-lg",
              "shadow-cyan-500/25",
            );
            b.classList.add("bg-white/5", "text-gray-400", "hover:bg-white/10");
          }
        });

        // Filter day sections
        daySections.forEach((section) => {
          const dayId = section.getAttribute("data-day");

          if (dayId === filterValue) {
            section.classList.remove("hidden");
            // Smooth scroll to selected section
            setTimeout(() => {
              section.scrollIntoView({ behavior: "smooth", block: "start" });
            }, 0);
          } else {
            section.classList.add("hidden");
          }
        });
      });
    });
  })();
</script>
